# frontend/Makefile
.PHONY: help dev-admin dev-all email-frontend password-frontend

include ../scripts/colors.mk


help: ## Frontend Cloudity
	@echo "$(PURPLE)ğŸ¨ Frontend Cloudity$(NC)"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "$(GREEN)%-20s$(NC) %s\\n", $$1, $$2}'


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# APPLICATIONS INDIVIDUELLES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

admin-dashboard: ## Admin dashboard
	@$(MAKE) -C admin-dashboard dev

email-app: ## Email application
	@$(MAKE) -C email-app dev-docker

password-app: ## Password manager
	@$(MAKE) -C password-app dev-docker

dev-admin: ## Admin dashboard
	$(call log_info,"DÃ©marrage admin dashboard")
	@docker compose -f ../docker-compose.yml up -d admin-dashboard  
	$(call log_success,"Admin dashboard: http://localhost:3000")

dev-all: ## Tous les frontends
	$(call log_info,"DÃ©marrage frontends")
	@$(MAKE) dev-admin
	@if [ -d "email-app" ]; then $(MAKE) email-app; fi
	@if [ -d "password-app" ]; then $(MAKE) password-app; fi
	$(call log_success,"Frontends dÃ©marrÃ©s")

email-frontend: ## Frontend email avec Docker
	$(call log_info,"DÃ©marrage frontend email")
	@docker compose -f ../docker-compose.yml up -d email-app
	$(call log_success,"Email app: http://localhost:8094")

password-frontend: ## Frontend password avec Docker
	$(call log_info,"DÃ©marrage frontend password")
	@docker compose -f ../docker-compose.yml up -d password-app
	$(call log_success,"Password app: http://localhost:8095")

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# TESTS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

test-admin-dashboard: ## Tests dashboard
	@$(MAKE) -C admin-dashboard test

test-email-app: ## Tests email app
	@$(MAKE) -C email-app test

test-password-app: ## Tests password app
	@$(MAKE) -C password-app test

test-all: ## Tests tous les frontends
	@for app in admin-dashboard email-app password-app; do \
		if [ -d "$$app" ]; then \
			$(MAKE) -C $$app test; \
		fi; \
	done

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# BUILD
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

build-admin-dashboard: ## Build dashboard
	@$(MAKE) -C admin-dashboard build

build-email-app: ## Build email app
	@$(MAKE) -C email-app build

build-password-app: ## Build password app
	@$(MAKE) -C password-app build

build-all: ## Build tous les frontends
	@for app in admin-dashboard email-app password-app; do \
		if [ -d "$$app" ]; then \
			$(MAKE) -C $$app build; \
		fi; \
	done

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# MAINTENANCE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

status: ## Status frontend
	@echo "$(PURPLE)Frontend Status:$(NC)"
	@docker compose -f ../docker-compose.yml ps admin-dashboard email-app password-app

clean: ## Nettoyage frontend
	@docker compose -f ../docker-compose.yml stop admin-dashboard email-app password-app
	@for app in admin-dashboard email-app password-app; do \
		if [ -d "$$app/node_modules" ]; then rm -rf $$app/node_modules; fi; \
	done

logs: ## Logs frontend
	@docker compose -f ../docker-compose.yml logs -f admin-dashboard email-app password-app